<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Plan de classe 403</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .container { display: flex; gap: 20px; align-items: flex-start; }

    /* Boîte “Lien” */
    .lien-box {
      flex: none;
      width: 80px;
      padding: 10px;
      background-color: #87CEEB;
      border-radius: 5px;
      text-align: center;
      cursor: pointer;
      user-select: none;
    }
    .lien-box:hover { background-color: #00bfff; }

    /* Grille de cases : 3 colonnes × 5 lignes */
    .cases {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    .case-box {
      background-color: #87CEEB;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      position: relative; /* nécessaire pour le trait vertical */
      overflow: hidden;
    }

    /* Trait vertical au milieu de chaque case */
    .case-box::before {
      content: "";
      position: absolute;
      top: 0;
      bottom: 0;
      left: 50%;
      border-left: 1px solid rgba(255,255,255,0.7);
    }

    .case-box.selected {
      background-color: #006400;
      color: #fff;
    }
    .case-box.selected::before {
      border-left-color: rgba(255,255,255,0.9);
    }

    .case-box .options {
      margin-top: 10px;
      display: none;
      padding-left: 10px;
    }
    .case-box.selected .options {
      display: block;
    }

    /* Zone de résultats */
    .result {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      min-width: 200px;
    }
    #result-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #result-list li {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <div class="container">
    <!-- 1) Boîte “Lien” -->
    <div class="lien-box" id="lien-box">Lien</div>

    <!-- 2) Grille 3×5 de cases -->
    <div class="cases">
      <!-- Cases 1 à 15 -->
      <div class="case-box" data-case="1">
        <div class="case-title">Case 1</div>
        <div class="options">
          <label><input type="checkbox" data-case="1" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="1" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="1" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="2">
        <div class="case-title">Case 2</div>
        <div class="options">
          <label><input type="checkbox" data-case="2" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="2" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="2" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="3">
        <div class="case-title">Case 3</div>
        <div class="options">
          <label><input type="checkbox" data-case="3" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="3" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="3" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="4">
        <div class="case-title">Case 4</div>
        <div class="options">
          <label><input type="checkbox" data-case="4" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="4" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="4" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="5">
        <div class="case-title">Case 5</div>
        <div class="options">
          <label><input type="checkbox" data-case="5" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="5" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="5" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>

      <div class="case-box" data-case="6">
        <div class="case-title">Case 6</div>
        <div class="options">
          <label><input type="checkbox" data-case="6" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="6" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="6" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="7">
        <div class="case-title">Case 7</div>
        <div class="options">
          <label><input type="checkbox" data-case="7" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="7" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="7" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="8">
        <div class="case-title">Case 8</div>
        <div class="options">
          <label><input type="checkbox" data-case="8" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="8" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="8" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="9">
        <div class="case-title">Case 9</div>
        <div class="options">
          <label><input type="checkbox" data-case="9" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="9" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="9" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="10">
        <div class="case-title">Case 10</div>
        <div class="options">
          <label><input type="checkbox" data-case="10" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="10" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="10" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>

      <div class="case-box" data-case="11">
        <div class="case-title">Case 11</div>
        <div class="options">
          <label><input type="checkbox" data-case="11" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="11" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="11" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="12">
        <div class="case-title">Case 12</div>
        <div class="options">
          <label><input type="checkbox" data-case="12" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="12" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="12" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="13">
        <div class="case-title">Case 13</div>
        <div class="options">
          <label><input type="checkbox" data-case="13" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="13" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="13" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="14">
        <div class="case-title">Case 14</div>
        <div class="options">
          <label><input type="checkbox" data-case="14" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="14" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="14" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="case-box" data-case="15">
        <div class="case-title">Case 15</div>
        <div class="options">
          <label><input type="checkbox" data-case="15" value="Comportement"> Comportement</label><br>
          <label><input type="checkbox" data-case="15" value="Travail non fait"> Travail non fait</label><br>
          <label><input type="checkbox" data-case="15" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
    </div>

    <!-- 3) Zone de résultats -->
    <div class="result">
      <ul id="result-list"></ul>
    </div>
  </div>

  <script>
    // Toggle des cases et options
    document.querySelectorAll('.case-box').forEach(box => {
      const num = box.dataset.case;
      box.addEventListener('click', e => {
        if (e.target.closest('.options')) return;
        box.classList.toggle('selected');
        const opts = box.querySelector('.options');
        if (box.classList.contains('selected')) {
          opts.style.display = 'block';
        } else {
          opts.style.display = 'none';
          opts.querySelectorAll('input[type=checkbox]').forEach(cb => {
            if (cb.checked) {
              cb.checked = false;
              removeResult(num, cb.value);
            }
          });
        }
      });
    });

    // Gestion des checkboxes
    document.querySelectorAll('.options input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', function() {
        const c = this.dataset.case;
        this.checked ? addResult(c, this.value) : removeResult(c, this.value);
      });
    });

    // Fonctions pour la zone Résultats
    const resultList = document.getElementById('result-list');
    function addResult(c, v) {
      const id = `result-${c}-${v}`;
      if (!document.getElementById(id)) {
        const li = document.createElement('li');
        li.id = id;
        li.textContent = `case n°${c} : ${v}`;
        resultList.appendChild(li);
      }
    }
    function removeResult(c, v) {
      const el = document.getElementById(`result-${c}-${v}`);
      if (el) el.remove();
    }

    // Clic sur “Lien” → génération JSON + téléchargement / fallback
    document.getElementById('lien-box').addEventListener('click', () => {
      const infractions = Array.from(
        document.querySelectorAll('#result-list li')
      ).map(li => li.textContent);

      // Date/heure Paris → JJ-MM-HHhMM
      const lok = new Intl.DateTimeFormat('fr-FR', {
        timeZone: 'Europe/Paris',
        year:   'numeric',
        month:  '2-digit',
        day:    '2-digit',
        hour:   '2-digit',
        minute: '2-digit'
      }).format(new Date());
      const [datePart, timePart] = lok.split(' ');
      const [day, month]         = datePart.split('/');
      const [hour, minute]       = timePart.split(':');
      const now = `${day}-${month}-${hour}h${minute}`;

      const payload = { date: now + ' (Europe/Paris)', infractions };
      const data    = JSON.stringify(payload, null, 2);

      const blob = new Blob([data], { type: 'application/json' });
      const url  = URL.createObjectURL(blob);
      const a    = document.createElement('a');

      if ('download' in a) {
        a.href     = url;
        a.download = `infractions_${now}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } else {
        window.open(url);
        setTimeout(() => URL.revokeObjectURL(url), 1000);
      }
    });
  </script>
</body>
</html>
