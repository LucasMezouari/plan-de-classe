<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Plan de classe 403</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f8f8f8;
      padding: 20px;
      text-align: center;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 160px);
      gap: 20px 50px;
      justify-content: center;
    }
    .cell {
      position: relative;
    }
    .half {
      position: relative;
      width: 160px;
      height: 60px;
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s;
      overflow: visible;
      margin-bottom: 10px;
    }
    .half.active {
      background-color: #c8facc;
    }
    .toggle-notes {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 14px;
      height: 14px;
      cursor: pointer;
      z-index: 10;
    }
    .notes-options {
      display: none;
      position: absolute;
      top: 22px;
      right: 4px;
      background: #fff;
      border: 1px solid #aaa;
      border-radius: 4px;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
      padding: 4px 8px;
      font-size: 12px;
      z-index: 9;
      text-align: left;
    }
    .notes-options label {
      display: block;
      margin-bottom: 2px;
      cursor: pointer;
    }
    .context-menu {
      position: absolute;
      display: none;
      background-color: #fff;
      border: 1px solid #aaa;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
      z-index: 1000;
      font-size: 13px;
    }
    .context-menu .menu-option {
      padding: 6px 12px;
      cursor: pointer;
    }
    .context-menu .menu-option.selected {
      background-color: #d0ebff;
    }
    .footer-layout {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 50px;
      position: relative;
    }
    .left-button {
      position: absolute;
      left: 20px;
      top: 80px;
      text-align: left;
    }
    .bouton, .tableau {
      width: 200px;
      height: 40px;
      background-color: #e0e0e0;
      border: 2px solid #666;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
      cursor: pointer;
      margin-top: 10px;
    }
    #presence-count {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 8px;
      color: #222;
    }
    #presence-result {
      position: absolute;
      left: 20px;
      top: 140px;
      text-align: left;
      font-size: 14px;
      color: #222;
      width: 200px;
    }
    #feedback {
      position: absolute;
      right: 20px;
      top: 100px;
      text-align: left;
      font-size: 14px;
      color: #222;
      width: 200px;
    }
  </style>
</head>
<body>
  <h1>Plan de classe 403</h1>
  <div class="grid">
    <!-- 15 cellules, 30 moitiés au total -->
    <!-- Exemple pour les deux premières cases, à dupliquer pour les autres -->
    <div class="cell">
      <div class="half">
        case 1
        <input type="checkbox" class="toggle-notes">
        <div class="notes-options">
          <label><input type="checkbox" value="Comportement"> Comportement</label>
          <label><input type="checkbox" value="Travail non fait"> Travail non fait</label>
          <label><input type="checkbox" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
      <div class="half">
        case 2
        <input type="checkbox" class="toggle-notes">
        <div class="notes-options">
          <label><input type="checkbox" value="Comportement"> Comportement</label>
          <label><input type="checkbox" value="Travail non fait"> Travail non fait</label>
          <label><input type="checkbox" value="Oubli de matériel"> Oubli de matériel</label>
        </div>
      </div>
    </div>
    <!-- ... Répétez pour les cases 3 à 30 ... -->
  </div>

  <div class="footer-layout">
    <div class="left-button">
      <!-- compteur de présents -->
      <div id="presence-count"></div>
      <div class="bouton" onclick="afficherAppel()">Appel terminé</div>
    </div>
    <div class="tableau">Tableau</div>
  </div>

  <div id="context-menu" class="context-menu">
    <div class="menu-option">Comportement</div>
    <div class="menu-option">Travail non fait</div>
    <div class="menu-option">Oubli de matériel</div>
  </div>

  <div id="presence-result"></div>
  <div id="feedback"></div>

  <script>
    let caseCible = null;
    const menu = document.getElementById("context-menu");
    const options = menu.querySelectorAll(".menu-option");
    let selectedIndex = 0;

    function selectOption(index) {
      options.forEach((opt, i) => opt.classList.toggle('selected', i === index));
      selectedIndex = index;
    }

    function openContextMenu(target) {
      caseCible = target;
      const rect = target.getBoundingClientRect();
      menu.style.left = `${rect.right + window.scrollX + 5}px`;
      menu.style.top = `${rect.top + window.scrollY}px`;
      menu.style.display = 'block';
      selectOption(0);
    }

    document.body.addEventListener('click', e => {
      if (!menu.contains(e.target)) menu.style.display = 'none';
    });

    options.forEach((opt, i) => {
      opt.addEventListener('click', () => {
        if (!caseCible) return;
        afficherFeedback(caseCible, opt.textContent);
        menu.style.display = 'none';
      });
    });

    function afficherFeedback(elementHalf, remarque) {
      const seatName = elementHalf.childNodes[0].textContent.trim();
      const div = document.getElementById("feedback");
      const ligne = document.createElement("div");
      ligne.innerHTML = `<strong>${seatName}</strong> : ${remarque}`;
      div.appendChild(ligne);
    }

    function afficherAppel() {
      const allHalves = Array.from(document.querySelectorAll('.half'));
      // Compte des présents (cases actives)
      const presentCount = allHalves.filter(h => h.classList.contains('active')).length;
      document.getElementById('presence-count').textContent = `Présents : ${presentCount}`;

      // Affichage des absents si besoin
      const absents = allHalves.filter(h => !h.classList.contains('active'));
      const absNames = [...new Set(absents.map(h => h.childNodes[0].textContent.trim()))];
      const out = document.getElementById('presence-result');
      out.innerHTML = `<div><strong>Absents (${absNames.length}) :</strong> ${absNames.join(', ')}</div>`;
    }

    document.querySelectorAll('.toggle-notes').forEach(cb => {
      cb.addEventListener('change', () => {
        const opts = cb.parentElement.querySelector('.notes-options');
        opts.style.display = cb.checked ? 'block' : 'none';
      });
    });

    document.querySelectorAll('.half').forEach(half => {
      let timer, isLongPress = false;
      half.addEventListener('mousedown', () => {
        isLongPress = false;
        timer = setTimeout(() => {
          isLongPress = true;
          openContextMenu(half);
        }, 500);
      });
      half.addEventListener('touchstart', e => {
        e.preventDefault();
        isLongPress = false;
        timer = setTimeout(() => {
          isLongPress = true;
          openContextMenu(half);
        }, 500);
      });
      half.addEventListener('mouseup', () => {
        clearTimeout(timer);
        if (!isLongPress) half.classList.toggle('active');
      });
      half.addEventListener('touchend', () => {
        clearTimeout(timer);
        if (!isLongPress) half.classList.toggle('active');
      });
      half.addEventListener('mouseleave', () => clearTimeout(timer));
    });
  </script>
</body>
</html>
